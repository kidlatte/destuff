@inject IHttpService Http

<EditForm OnValidSubmit="OnSubmit" Model="Model">
    <MudDialog>
        <TitleContent>
            <MudText Typo="Typo.h6">Add Maintenance</MudText>
        </TitleContent>
        <DialogContent>
            <DataAnnotationsValidator />
            <MudAutocomplete T="string" @bind-Value="Model.Name" SearchFunc="@SearchDefaults" CoerceValue="true"
                Label="Name" Variant="Variant.Outlined" Adornment="Adornment.None" />

            <MudNumericField @bind-Value="Model.EveryXDays" For="@(() => Model.EveryXDays)" Disabled="loading"
                Label="Every x days" Variant="Variant.Outlined" />

            <MudTextField @bind-Value="Model.Notes" For="@(() => Model.Notes)" Disabled="loading"
                Label="Notes" Variant="Variant.Outlined" Lines="3" />

            <MudText Color="@Color.Error">@error</MudText>
        </DialogContent>
        <DialogActions>
            <LoadingButton Loading="loading" />
            <MudButton OnClick="() => dialog?.Cancel()" Disabled="loading" Color="Color.Default">
                Cancel
            </MudButton>
        </DialogActions>
    </MudDialog>
</EditForm>

@code {
    [CascadingParameter]
    MudDialogInstance? dialog { get; set; }

    [Parameter]
    public required MaintenanceRequest Model { get; set; }

    string error { get; set; } = "";
    bool loading { get; set; } = false;

    async Task OnSubmit()
    {
        loading = true;

        try
        {
            var result = await Http.PostAsync<MaintenanceModel>(ApiRoutes.Maintenances, Model);
            dialog?.Close(DialogResult.Ok(result));
        }
        catch (Exception ex)
        {
            error = ex.Message;
        }

        loading = false;
    }

    Task<IEnumerable<string>> SearchDefaults(string? value)
    {
        return Task.FromResult(MaintenanceDefaults.Names.Where(x => x.Contains(value ?? "", StringComparison.InvariantCultureIgnoreCase)));
    }
}